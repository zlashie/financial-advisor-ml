<div class="container">
  <h1>ML Debt & Investment Advisor</h1>

  <div class="grid">
    <!-- Debts -->
    <section class="card">
      <h2>Debts</h2>
      <div *ngFor="let d of debts; let i = index" class="row">
        <input type="number" [(ngModel)]="d.amount" placeholder="Amount" />
        <input type="number" step="0.001" [(ngModel)]="d.apr" placeholder="APR (0..1)" />
        <button class="link" (click)="removeDebt(i)" [disabled]="debts.length===1">Remove</button>
      </div>
      <button class="secondary" (click)="addDebt()">+ Add debt</button>
    </section>

    <!-- Investments -->
    <section class="card">
      <h2>Investments</h2>
      <div class="row">
        <input type="number" [(ngModel)]="investments.equity_value" placeholder="Equity value" />
        <input type="number" [(ngModel)]="investments.property_value" placeholder="Property value" />
        <input type="number" step="0.001" [(ngModel)]="investments.property_growth_rate" placeholder="Property growth (yr)" />
        <input type="number" step="0.001" [(ngModel)]="investments.equity_return_rate" placeholder="Equity return (yr)" />
      </div>
    </section>

    <!-- Horizon -->
    <section class="card">
      <h2>Time horizon</h2>
      <input type="number" [(ngModel)]="horizon_years" />
    </section>

    <!-- Monthly -->
    <section class="card">
      <h2>Monthly surplus</h2>
      <input type="number" [(ngModel)]="monthly_extra" />
      <button class="primary" (click)="calculate()" [disabled]="loading">Calculate</button>
    </section>
  </div>

  <p *ngIf="loading" class="muted">Calculating…</p>
  <p *ngIf="error" class="error">Request failed</p>

  <hr />

  <div *ngIf="result as r" class="result">
    <h2>Recommended split</h2>
    <p>
      To Debt: <b>{{r.allocation.to_debt | number:'1.0-2'}}</b> —
      To Investing: <b>{{r.allocation.to_investing | number:'1.0-2'}}</b>
      (ratio {{r.allocation.ratio | number:'1.0-2'}})
    </p>

    <h3>Explain</h3>
    <ul class="bullets">
      <li *ngFor="let e of r.explain">{{e}}</li>
    </ul>

    <!-- Chart -->
    <div class="chart-wrap">
      <canvas baseChart
        [type]="lineChartType"
        [data]="lineChartData"
        [options]="lineChartOptions"
        [plugins]="[zeroLinePlugin]">
      </canvas>
    </div>

    <details class="raw">
      <summary>Projections (raw)</summary>
      <pre>{{ r.projections | json }}</pre>
    </details>
  </div>
</div>
